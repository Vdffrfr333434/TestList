<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MSE Опросник</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap');

  html, body {
    margin:0; padding:0; height:100%;
    background: url('https://www.transparenttextures.com/patterns/cubes.png') repeat;
    background-color: #121212;
    font-family: 'Montserrat', sans-serif;
    color: #eee;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  body::before {
    content: "";
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    backdrop-filter: blur(10px);
    z-index: -1;
  }

  .center {
    background: rgba(32,32,32,0.6);
    border-radius: 15px;
    box-shadow: 0 8px 32px 0 rgba(0,0,0,0.37);
    padding: 30px 40px;
    max-width: 450px;
    width: 90vw;
    text-align: center;
    user-select: none;
  }

  h1, h2 {
    margin-bottom: 20px;
    font-weight: 600;
  }

  input[type=text] {
    width: 100%;
    padding: 12px 15px;
    margin: 10px 0 25px;
    border-radius: 10px;
    border: none;
    font-size: 1rem;
    background: rgba(255 255 255 / 0.1);
    color: #eee;
    outline: none;
  }

  .btn {
    background: rgba(255,255,255,0.15);
    border: none;
    border-radius: 12px;
    padding: 15px;
    margin: 8px 0;
    width: 100%;
    font-size: 1rem;
    color: #eee;
    cursor: pointer;
    transition: background 0.3s ease;
    user-select: none;
  }
  .btn:hover, .btn.selected {
    background: rgba(255,255,255,0.35);
  }

  #result-page {
    text-align: left;
    background: rgba(40,40,40,0.7);
    padding: 25px 30px;
    border-radius: 15px;
  }

  #result-page h2 {
    text-align: center;
    margin-bottom: 15px;
  }

  #answer-list p {
    margin: 10px 0;
  }

  button#download-pdf-btn {
    display: block;
    margin: 25px auto 0;
    padding: 15px 30px;
    font-size: 1rem;
    border-radius: 15px;
    background: rgba(255,255,255,0.2);
    border: none;
    color: #eee;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  button#download-pdf-btn:hover {
    background: rgba(255,255,255,0.45);
  }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
  <div class="center" id="app">
    <!-- Здесь будут формы и вопросы -->
  </div>

<script>
(() => {
  const app = document.getElementById('app');

  let username = '';
  let contact = '';
  const answers = [];

  // Вопросы с вариантами (пример, расширяй как хочешь)
  const questions = [
    {
      question: 'Что ты делаешь сразу после пробуждения',
      options: [
        'Проверяю сообщения',
        'Завтракаю',
        'Пью воду/кофе, но не ем',
        'Направляюсь в уборную',
        'Делаю зарядку'
      ]
    },
    {
      question: 'Первый приём пищи у тебя',
      options: [
        'Завтрак дома',
        'Завтрак вне дома',
        'Обед вне дома',
        'По ситуации'
      ]
    },
    {
      question: 'Долгое время без еды я:',
      options: [
        'Переношу без проблем',
        'Чувствую голод',
        'Не чувствую голод',
        'Чувствую сильный дискомфорт'
      ]
    },
    {
      question: 'После еды я:',
      options: [
        'Ощущаю прилив сил и энергии',
        'Хочу полежать, переварить еду',
        'Хочу походить, переварить еду',
        'Хочу спать',
        'Ощущаю жар'
      ]
    },
    {
      question: 'Утром я встаю:',
      options: [
        'Рано, без будильника',
        'Рано, с будильником',
        'По ситуации',
        'Встаю поздно и тяжело',
        'Встаю поздно легко'
      ]
    },
    {
      question: 'В жару мне:',
      options: [
        'Очень жарко, много потею',
        'Очень жарко, но не потею или потею мало',
        'Нормально переношу жару'
      ]
    },
    {
      question: 'В холодную погоду я:',
      options: [
        'Очень мёрзну и не могу согреться',
        'Нормально переношу холод'
      ]
    },
    {
      question: 'После тренировки я:',
      options: [
        'Очень хочу есть',
        'Очень хочу пить',
        'Могу не есть несколько часов',
        'Хочу спать',
        'Ощущаю прилив сил'
      ]
    },
    {
      question: 'Я засыпаю:',
      options: [
        'Без проблем, в одно и то же время',
        'Тяжело засыпаю, иногда не получается уснуть',
        'По-разному, зависит от усталости',
        'Бессонница'
      ]
    },
    {
      question: 'Сон:',
      options: [
        'Глубокий и монолитный',
        'Много просыпаюсь ночью',
        'Просыпаюсь несколько раз за ночь'
      ]
    },
    {
      question: 'После тренировок я ощущаю боль:',
      options: [
        'В тот же день',
        'На следующий день',
        'Через день',
        'Не ощущаю вообще, хотя на тренировках мне тяжело'
      ]
    },
    {
      question: 'У меня:',
      options: [
        'Нет одышки',
        'Есть, но редко',
        'Часто задыхаюсь'
      ]
    },
    {
      question: 'Я пью:',
      options: [
        'По ощущениям',
        'Контролирую воду, пью свою норму в день',
        'Не слежу за этим'
      ]
    },
    {
      question: 'Я:',
      options: [
        'Постоянно солю еду',
        'Редко, когда очень пресная',
        'Вообще не добавляю соль'
      ]
    },
    {
      question: 'Больше всего после тренировки мне хочется:',
      options: [
        'Жирного',
        'Сладкого',
        'Мучного',
        'Молочного',
        'Воды'
      ]
    },
    {
      question: 'После тренировки вес:',
      options: [
        'Стоит',
        'Растёт',
        'Падает'
      ]
    },
    {
      question: 'Утром вес:',
      options: [
        'Больше, чем вечером',
        'Такой же',
        'Меньше, чем вечером'
      ]
    },
    {
      question: 'Я дышу:',
      options: [
        'Через рот',
        'Через нос',
        'Обоими',
        'Когда как'
      ]
    }
  ];

  let step = 0; // этап: 0 — ввод данных, >=1 — вопросы (step-1), последний этап — результат

  function renderIntro() {
    app.innerHTML = `
      <h1>Добро пожаловать в опросник MSE</h1>
      <input id="username" type="text" placeholder="Ваше имя" autocomplete="off" />
      <input id="contact" type="text" placeholder="Контакт (email, Telegram и т.п.)" autocomplete="off" />
      <button class="btn" id="start-btn">Начать опрос</button>
    `;
    document.getElementById('start-btn').onclick = () => {
      const nameVal = document.getElementById('username').value.trim();
      const contactVal = document.getElementById('contact').value.trim();
      if (!nameVal || !contactVal) {
        alert('Пожалуйста, заполните имя и контакт для связи.');
        return;
      }
      username = nameVal;
      contact = contactVal;
      step = 1;
      renderQuestion();
    };
  }

  function renderQuestion() {
    if (step > questions.length) {
      showResultPage();
      return;
    }

    const q = questions[step - 1];
    app.innerHTML = `
      <h2>Вопрос ${step} из ${questions.length}</h2>
      <p style="margin-bottom: 25px; font-weight: 600;">${q.question}</p>
      <div id="options-container"></div>
    `;

    const container = document.getElementById('options-container');
    q.options.forEach(option => {
      const btn = document.createElement('button');
      btn.className = 'btn';
      btn.textContent = option;
      btn.onclick = () => {
        answers.push({ question: q.question, answer: option });
        step++;
        renderQuestion();
      };
      container.appendChild(btn);
    });
  }

  function showResultPage() {
    app.innerHTML = `
      <div id="result-page">
        <h2>Ваш индивидуальный отчёт</h2>
        <p><strong>Имя:</strong> ${username}</p>
        <p><strong>Контакт:</strong> ${contact}</p>
        <hr>
        <div id="answer-list">
          ${answers.map((a, i) => `
            <p><strong>${i + 1}. ${a.question}</strong><br>Ответ: ${a.answer}</p>
          `).join('')}
        </div>
        <button id="download-pdf-btn">Скачать PDF</button>
      </div>
    `;

    document.getElementById('download-pdf-btn').onclick = () => {
      const element = document.getElementById('result-page');
      const opt = {
        margin:       0.5,
        filename:     `mse_report_${username.replace(/\s+/g, '_')}.pdf`,
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2, logging: false },
        jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
      };
      html2pdf().set(opt).from(element).save();
    };
  }

  renderIntro();
})();
</script>
</body>
</html>
