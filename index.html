<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MSE Опросник с Категориями и Баллами</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;600&display=swap');

  html, body {
    margin: 0; padding: 0; height: 100%;
    background: url('https://i.ibb.co/67n9YYCS/MSE-Quiz-BG.png') no-repeat center center fixed;
    background-size: cover;
    font-family: 'IBM Plex Sans', sans-serif;
    color: #eee;
    overflow-x: hidden;
    background-color: #000;
  }

  .center {
    background: #2c2c2c;
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 25px 30px;
    max-width: 300px;
    width: 45vw;
    text-align: center;
    user-select: none;
    margin: 25vh auto 40px auto;
    opacity: 0;
    transform: translateY(20px);
    animation: fadeIn 250ms ease-out forwards;
    line-height: 1.3;
  }

  @keyframes fadeIn {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  h1, h2, h3 {
    margin-bottom: 20px;
    font-weight: 600;
  }

  .btn {
    background: rgba(255,255,255,0.05);
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 15px;
    margin: 8px auto;
    width: 45%;
    font-size: 1rem;
    color: #eee;
    cursor: pointer;
    transition: background 0.3s ease;
    user-select: none;
    display: block;
  }

  .btn:hover, .btn.selected {
    background: rgba(255,255,255,0.1);
  }

  input[type="text"] {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 4px;
    border: 1px solid #ccc;
    font-size: 1rem;
  }

  .error-message {
    color: red;
    font-size: 0.9rem;
    margin-top: -8px;
    margin-bottom: 10px;
  }

  .hidden {
    display: none;
  }

  @media(max-width: 600px) {
    .center {
      width: 90vw;
      padding: 20px;
    }
    .btn {
      width: 80%;
    }
  }
</style>
</head>
<body>
<!-- Первый экран -->
<div class="center" id="welcome-screen">
  <img src="https://i.ibb.co/r2K5tJph/MSE-Logo-420-110.png" alt="Логотип MSE" style="max-width: 100%; margin-bottom: 20px;" />
  <input type="text" id="username" placeholder="Имя" style="width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #58a6ff;" />
  <div id="name-error" class="error-message hidden">Пожалуйста, введите имя</div>
  <input type="text" id="contact" placeholder="Контакт для связи" style="width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #58a6ff;" />
  <div id="contact-error" class="error-message hidden">Пожалуйста, введите контакт</div>
  <button class="btn" id="start-btn">Начать тестирование</button>
</div>

<!-- Второй экран -->
<div class="center hidden" id="disclaimer-screen">
  <p style="margin-bottom: 20px;">Данные будут обработаны с использованием искусственного интеллекта. Продолжая, вы соглашаетесь на обработку персональных данных.</p>
  <button class="btn" id="agree-btn">Продолжить тестирование</button>
  <button class="btn" onclick="window.location.reload()">Отменить тестирование</button>
</div>

<!-- Экран вопросов -->
<div class="center hidden" id="question-screen">
  <h3 id="question-category"></h3>
  <div id="question-text"></div>
  <div id="answers"></div>
</div>

<!-- Экран результатов -->
<div class="center hidden" id="results-screen">
  <div id="result-blocks"></div>
  <button class="btn" id="download-btn">Скачать PDF</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
const questions = [
  { category: 'Метаболизм', text: 'Как часто вы испытываете чувство голода?', options: [
    { text: 'Очень редко', value: 1 },
    { text: 'Иногда', value: 2 },
    { text: 'Умеренно', value: 3 },
    { text: 'Часто', value: 4 },
    { text: 'Постоянно', value: 5 },
  ]},
  { category: 'Когнитивные способности', text: 'Насколько быстро вы усваиваете новую информацию?', options: [
    { text: 'Очень медленно', value: 1 },
    { text: 'Медленно', value: 2 },
    { text: 'Средне', value: 3 },
    { text: 'Быстро', value: 4 },
    { text: 'Мгновенно', value: 5 },
  ]}
];

let categories = {}; // changed from const to let
const questionScreen = document.getElementById('question-screen');
const resultsScreen = document.getElementById('results-screen');
const resultBlocks = document.getElementById('result-blocks');
let currentQuestion = 0;

function startSurvey() {
  currentQuestion = 0;
  categories = {};
  showQuestion();
}

function showQuestion() {
  const q = questions[currentQuestion];
  document.getElementById('question-category').textContent = q.category;
  document.getElementById('question-text').textContent = q.text;
  const answersDiv = document.getElementById('answers');
  answersDiv.innerHTML = '';
  q.options.forEach((opt, idx) => {
    const btn = document.createElement('button');
    btn.className = 'btn';
    btn.textContent = opt.text;
    btn.onclick = () => {
      if (!categories[q.category]) categories[q.category] = 0;
      categories[q.category] += opt.value;
      currentQuestion++;
      if (currentQuestion < questions.length) {
        showQuestion();
      } else {
        showResults();
      }
    };
    answersDiv.appendChild(btn);
  });
}

function showResults() {
  questionScreen.classList.add('hidden');
  resultsScreen.classList.remove('hidden');
  resultBlocks.innerHTML = '';

  for (const cat in categories) {
    let comment = '';
    const score = categories[cat];
    if (score <= 2) comment = 'Всё хорошо';
    else comment = 'Есть отклонения';

    const div = document.createElement('div');
    div.style.marginBottom = '20px';
    div.textContent = `${cat}: ${comment}`;
    resultBlocks.appendChild(div);
  }
}

const startBtn = document.getElementById('start-btn');
const welcomeScreen = document.getElementById('welcome-screen');
const disclaimerScreen = document.getElementById('disclaimer-screen');
const agreeBtn = document.getElementById('agree-btn');
const nameInput = document.getElementById('username');
const contactInput = document.getElementById('contact');
const nameError = document.getElementById('name-error');
const contactError = document.getElementById('contact-error');

startBtn.addEventListener('click', () => {
  let valid = true;
  nameError.classList.add('hidden');
  contactError.classList.add('hidden');

  if (!nameInput.value.trim()) {
    nameError.classList.remove('hidden');
    valid = false;
  }
  if (!contactInput.value.trim()) {
    contactError.classList.remove('hidden');
    valid = false;
  }
  if (valid) {
    welcomeScreen.classList.add('hidden');
    disclaimerScreen.classList.remove('hidden');
  }
});

agreeBtn.addEventListener('click', () => {
  disclaimerScreen.classList.add('hidden');
  questionScreen.classList.remove('hidden');
  startSurvey();
});

document.getElementById('download-btn').addEventListener('click', () => {
  const element = document.getElementById('result-blocks');
  html2pdf().from(element).set({
    margin: 0.5,
    filename: 'MSE_results.pdf',
    html2canvas: { scale: 2 },
    jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
  }).save();
});
</script>
</body>
</html>
